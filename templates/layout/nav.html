{% block nav %} {# starter div #}

<script>
  var countMessage;
</script>
<!-- Header Menu Area Start Here -->
<div class="navbar navbar-expand-md header-menu-one bg-light">
  <div class="nav-bar-header-one">
    <div class="header-logo">
      <a href="">
        <img src="/img/logo.png" alt="logo" />
      </a>
    </div>
    <div class="toggle-button sidebar-toggle">
      <button type="button" class="item-link">
        <span class="btn-icon-wrap">
          <span></span>
          <span></span>
          <span></span>
        </span>
      </button>
    </div>
  </div>
  <div class="d-md-none mobile-nav-bar">
    <button
      class="navbar-toggler pulse-animation"
      type="button"
      data-toggle="collapse"
      data-target="#mobile-navbar"
      aria-expanded="false"
    >
      <i class="far fa-arrow-alt-circle-down"></i>
    </button>
    <button type="button" class="navbar-toggler sidebar-toggle-mobile">
      <i class="fas fa-bars"></i>
    </button>
  </div>
  <div class="header-main-menu collapse navbar-collapse" id="mobile-navbar">
    <ul class="navbar-nav">
      <li class="navbar-item header-search-bar">
        <div class="input-group stylish-input-group">
          <span class="input-group-addon">
            <button type="submit">
              <span class="flaticon-search" aria-hidden="true"></span>
            </button>
          </span>
          <input
            type="text"
            class="form-control"
            placeholder="Find Something . . ."
          />
        </div>
      </li>
    </ul>
    <ul class="navbar-nav">
      <li class="navbar-item dropdown header-admin">
        <a
          class="navbar-nav-link dropdown-toggle"
          href="#"
          role="button"
          data-toggle="dropdown"
          aria-expanded="false"
        >
          <div class="admin-title">
            <h5 class="item-title">
              {% if session.user == ' ' %} {{ session.username }} {% else %} {{ session.user }} {% endif
              %}
            </h5>
            <span>{{ session.type_user }}</span>
          </div>
          <div class="admin-img">
            <img
              src="/uploads/Profile/{{session.photo_user}}"
              style="width: 40px"
              alt="Admin"
            />
          </div>
        </a>
        <div class="dropdown-menu dropdown-menu-right">
          <div class="item-header">
            <h6 class="item-title">{{ user }}</h6>
          </div>
          <div class="item-content">
            <ul class="settings-list">
              <li>
                <a href="/profile-setting"
                  ><i class="flaticon-user"></i>My Profile</a
                >
              </li>
              <li>
                <a href="#"><i class="flaticon-list"></i>Task</a>
              </li>
              <li>
                <a href="/messaging"
                  ><i
                    class="flaticon-chat-comment-oval-speech-bubble-with-text-lines"
                  ></i
                  >Message</a
                >
              </li>
              <li>
                <a href="/account-settings"
                  ><i class="flaticon-gear-loading"></i>Account Settings</a
                >
              </li>
              <li>
                <a href="/logout"><i class="flaticon-turn-off"></i>Log Out</a>
              </li>
            </ul>
          </div>
        </div>
      </li>
      <li class="navbar-item dropdown header-message">
        <a
          class="navbar-nav-link dropdown-toggle"
          href="#"
          role="button"
          data-toggle="dropdown"
          aria-expanded="false"
        >
          <i class="far fa-envelope"></i>
          <div class="item-title d-md-none text-16 mg-l-10">Message</div>
          {# Jumlah total message #}
          <span id="iconCountMessage">{{countMessag}}</span>
        </a>

        <div class="dropdown-menu dropdown-menu-right">
          <div class="item-header">
            {# Jumlah total message #}
            <h6 class="item-title" id="countMessage"> Message</h6>
          </div>
          <div class="item-content">
            {# message start here #}
            {# <div class="media">
              <div class="item-img bg-skyblue author-online">
                <img src="/img/figure/student11.png" alt="img" />
              </div>
              <div class="media-body space-sm">
                <div class="item-title">
                  <a href="#">
                    <span class="item-name">Maria Zaman</span>
                    <span class="item-time">18:30</span>
                  </a>
                </div>
                <p>
                  What is the reason of buy this item. Is it usefull for me.....
                </p>
              </div>
            </div> #}
            {# {{auth|json_encode()}} #}
            {% for message in auth %}
            {% set countMessag = message.totalMessage %}
            {% if message.readed == 1 %}
            <div class="media message_Class" data-idMessage="{{message.id_message}}">
              {% else %}
              <div class="media message_Class" data-idMessage="{{message.id_message}}">
            {% endif %}
              <div class="item-img bg-skyblue">
                <img src="/uploads/Profile/{{message.photo_sender}}" style="width: 40px;" alt="img"/>
              </div>
              <div class="media-body space-sm">
                <div class="item-title">
                  <a href="#">
                    <span class="item-name">{{message.first_name_sender}} {{message.last_name_sender}}</span>
                    <span class="item-time">{{message.time_sender|date("m/d/Y")}} {{message.totalMessage}}</span>
                  </a>
                </div>
                <h3>{{message.title}}</h3>
                <p>
                 {{message.message}}
                </p>
              </div>
            </div>
                  
            <script>
              
              countMessage = {{countMessag}};
              //console.log(countMessage);  
            </script>
            {% endfor %}
            {# message end here #}
          </div>
        </div>
      </li>
      <li class="navbar-item dropdown header-notification">
        <a
          class="navbar-nav-link dropdown-toggle"
          href="#"
          role="button"
          data-toggle="dropdown"
          aria-expanded="false"
        >
          <i class="far fa-bell"></i>
          <div class="item-title d-md-none text-16 mg-l-10">Notification</div>
          <span>8</span>
        </a>

        <div class="dropdown-menu dropdown-menu-right">
          <div class="item-header">
            <h6 class="item-title">03 Notifiacations</h6>
          </div>
          <div class="item-content">
            <div class="media">
              <div class="item-icon bg-skyblue">
                <i class="fas fa-check"></i>
              </div>
              <div class="media-body space-sm">
                <div class="post-title">Complete Today Task</div>
                <span>1 Mins ago</span>
              </div>
            </div>
            <div class="media">
              <div class="item-icon bg-orange">
                <i class="fas fa-calendar-alt"></i>
              </div>
              <div class="media-body space-sm">
                <div class="post-title">Director Metting</div>
                <span>20 Mins ago</span>
              </div>
            </div>
            <div class="media">
              <div class="item-icon bg-violet-blue">
                <i class="fas fa-cogs"></i>
              </div>
              <div class="media-body space-sm">
                <div class="post-title">Update Password</div>
                <span>45 Mins ago</span>
              </div>
            </div>
          </div>
        </div>
      </li>
      {#
      <li class="navbar-item dropdown header-language">
        <a
          class="navbar-nav-link dropdown-toggle"
          href="#"
          role="button"
          data-toggle="dropdown"
          aria-expanded="false"
          ><i class="fas fa-globe-americas"></i>EN</a
        >
        <div class="dropdown-menu dropdown-menu-right">
          <a class="dropdown-item" href="#">English</a>
          <a class="dropdown-item" href="#">Spanish</a>
          <a class="dropdown-item" href="#">Franchis</a>
          <a class="dropdown-item" href="#">Chiness</a>
        </div>
      </li>
      #}
      <i class="fas fa-globe-americas"></i>
      <div id="google_translate_element"></div>
    </ul>
  </div>
</div>
<!-- Header Menu Area End Here -->
<script>
  $(document).ready(function () {      
    console.log(countMessage)
    $('#iconCountMessage').html(countMessage);
    $('#countMessage').html(''+countMessage+' Message');
    $('.message_Class').click(function (e) { 
        e.preventDefault();
        var id = $(this).attr('data-idMessage');
        //console.log($id)
        $.ajax({
          type: "POST",
          url: "/readedMessage",
          data: {
              id_message : id
          },
          dataType: "JSON",
          success: function (response) {
              console.log(response)
              //  $('.message_Class').addClass('bg-secondary')
          }
      });
    });
});
</script>
{% endblock nav %}
