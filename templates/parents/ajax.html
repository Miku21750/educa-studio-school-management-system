{% block ajaxparent %}
<script type="text/javascript">

    $(document).ready(function () {
        Tabel1Show = function () {

            table = $("#parent").on('preXhr.dt', function (e, settings, data) {

                console.log('loading ....');

            }).on('draw.dt', function () {
                console.log('dapat data ....');

            }).DataTable({
                responsive: {
                    details: {
                        type: 'column'
                    }
                },
                "columnDefs": [
                    { "width": "1%", "targets": 0, className: "text-center", "orderable": false },
                    { "width": "10%", "targets": 1, className: "text-start", "orderable": false },
                    { "width": "10%", "targets": 2, className: "text-start", "orderable": false },
                    { "width": "10%", "targets": 3, className: "text-start", "orderable": false },
                    { "width": "10%", "targets": 4, className: "text-start", "orderable": false },
                    { "width": "10%", "targets": 5, className: "text-start", "orderable": false },
                    { "width": "15%", "targets": 6, className: "text-start", "orderable": false },
                    { "width": "15%", "targets": 7, className: "text-start", "orderable": false },
                    { "width": "15%", "targets": 8, className: "text-end", "orderable": false }

                ],
                'pageLength': 10,
                'responsive': true,
                'processing': true,
                'serverSide': true,
                'ajax': {
                    'url': "/api/allparents",
                    'dataType:': 'json',
                    'type': 'get',

                },
                'columns': [
                    { 'data': 'no' },
                    { 'data': 'foto' },
                    { 'data': 'nama' },
                    { 'data': 'gender' },
                    { 'data': 'pekerjaan' },
                    { 'data': 'alamat' },
                    { 'data': 'telepon' },
                    { 'data': 'email' },
                    { 'data': 'aksi' }

                ]


            });

        }
        Tabel1Show();
        //GET HAPUS
        $('#show_data').on('click', '.item_hapus', function () {
            var id = $(this).attr('data');
            $('#confirmation-modal').modal('show');
            $('[name="kode"]').val(id);
        });

        //Hapus Data
        $('#btn_hapus').on('click', function () {
            var kode = $('#textkode').val();
            $.ajax({
                type: "POST",
                url: "/api/delete-parent",
                dataType: "JSON",
                data: { kode: kode },
                success: function (data) {
                    if (data) {
                        $('#confirmation-modal').modal('hide');
                        let timerInterval
                        Swal.fire({
                            title: 'Memuat Data...',
                            html: 'Tunggu  <b></b>  Detik.',
                            timer: 300,
                            timerProgressBar: true,
                            didOpen: () => {
                                Swal.showLoading()
                                const b = Swal.getHtmlContainer().querySelector('b')
                                timerInterval = setInterval(() => {
                                    b.textContent = Swal.getTimerLeft()
                                }, 100)
                            },
                            willClose: () => {
                                clearInterval(timerInterval)
                            }
                        }).then((result) => {
                            Swal.fire(
                                {
                                    icon: 'success',
                                    title: 'Berhasil',
                                    text: 'Data telah dihapus.',
                                    //footer: '<a href="">Why do I have this issue?</a>'
                                }

                            )
                        })
                        table.draw(false)

                    } else {
                        Swal.fire({
                            icon: 'error',
                            title: 'Oops...',
                            text: 'Ada yang eror!',
                            //footer: '<a href="">Why do I have this issue?</a>'
                        })
                    }



                    //tampil_data_barang();
                }
            });
            return false;
        });

        //tambah Data
        $('#btn_simpan').on('click', function () {
            var first_name = $('#first_name').val();
            var last_name = $('#last_name').val();
            var gender = $('#gender').val();
           
            $.ajax({
                type: "POST",
                url: "/api/add-parent",
                dataType: "JSON",
                data: { first_name: first_name, last_name: last_name, gender: gender, id_jurusan: id_jurusan },
                success: function (data) {
                    if (data) {
                        let timerInterval
                        Swal.fire({
                            title: 'Memuat Data...',
                            html: 'Tunggu  <b></b>  Detik.',
                            timer: 300,
                            timerProgressBar: true,
                            didOpen: () => {
                                Swal.showLoading()
                                const b = Swal.getHtmlContainer().querySelector('b')
                                timerInterval = setInterval(() => {
                                    b.textContent = Swal.getTimerLeft()
                                }, 100)
                            },
                            willClose: () => {
                                clearInterval(timerInterval)
                            }
                        }).then((result) => {
                            Swal.fire(
                                {
                                    icon: 'success',
                                    title: 'Berhasil',
                                    text: 'Data telah ditambahkan.',
                                    //footer: '<a href="">Why do I have this issue?</a>'
                                }

                            )
                     
                        })

                    } else {
                        Swal.fire({
                            icon: 'error',
                            title: 'Oops...',
                            text: 'Ada yang eror!',
                            //footer: '<a href="">Why do I have this issue?</a>'
                        })
                    }

                }
            });
            return false;
        });

    });

    //GET Details
    function dateFormat(inputDate, format) {
        //parse the input date
        const date = new Date(inputDate);

        //extract the parts of the date
        const day = date.getDate();
        const month = date.getMonth() + 1;
        const year = date.getFullYear();

        //replace the month
        format = format.replace("MM", month.toString().padStart(2, "0"));

        //replace the year
        if (format.indexOf("yyyy") > -1) {
            format = format.replace("yyyy", year.toString());
        } else if (format.indexOf("yy") > -1) {
            format = format.replace("yy", year.toString().substr(2, 2));
        }

        //replace the day
        format = format.replace("dd", day.toString().padStart(2, "0"));

        return format;
    }

    $('#show_data').on('click', '.item_detail', function () {
        var id = $(this).attr('data');
        $.ajax({
            type: "GET",
            url: "/" + "api" + "/" + id + "/detail",
            dataType: "JSON",
            data: { id: id },
            success: function (data) {
                $.each(data, function (id_user, first_name, email, last_name, short_bio, gender, date_of_birth,
                    religion,photo_user) {
                        console.log(data[0]);
                    $('#large-modal').modal('show');
                    $('[name="photo"]').attr("src","/img/figure/"+data[0].photo_user);
                    $('[name="bio"]').html(data[0].short_bio);
                    $('[name="first_name"]').html(data[0].first_name + ' ' + data[0].last_name);
                    $('[name="email"]').html(data[0].email);
                    $('[name="gender"]').html(data[0].gender);
                    $('[name="date_of_birth"]').html(dateFormat(data[0].date_of_birth, 'dd-MM-yyyy'));
                    $('[name="religion"]').html(data[0].religion);
                    $('[name="username"]').html(data[0].username);
                    $('[name="blood_group"]').html(data[0].blood_group);
                    $('[name="occupation"]').html(data[0].occupation);
                    $('[name="address_user"]').html(data[0].address_user);
                    $('[name="phone_user"]').html(data[0].phone_user);
                    $('[name="ebio"]').val(data[0].short_bio);
                    $('[name="efirst_name"]').val(data[0].first_name);
                    $('[name="elast_name"]').val(data[0].last_name);
                    $('[name="eemail"]').val(data[0].email);
                    $('[name="egender"]').val(data[0].gender);
                    $('[name="edate_of_birth"]').val(data[0].date_of_birth);
                    $('[name="ereligion"]').val(data[0].religion);
                    $('[name="eusername"]').val(data[0].username);
                    $('[name="eblood_group"]').val(data[0].blood_group);
                    $('[name="eoccupation"]').val(data[0].occupation);
                    $('[name="eaddress_user"]').val(data[0].address_user);
                    $('[name="ephone_user"]').val(data[0].phone_user);
                });
            }
        });
        return false;
    });



</script>



{% endblock ajaxparent %}